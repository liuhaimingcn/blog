<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Nginx 安装 - 寻梦的尕柳</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="安装编译工具及库文件
切换到root用户下面
yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel">
<meta property="og:type" content="article">
<meta property="og:title" content="Nginx 安装">
<meta property="og:url" content="http://www.haiyue.me/2016/09/06/nginx-install/index.html">
<meta property="og:site_name" content="寻梦的尕柳">
<meta property="og:description" content="安装编译工具及库文件
切换到root用户下面
yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nginx 安装">
<meta name="twitter:description" content="安装编译工具及库文件
切换到root用户下面
yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      <a id="logo" class="logo logo-text" href="/">寻梦的尕柳</a>
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/categories/编程">编程</a>
        
          <a class="main-nav-link" href="/categories/笔记">笔记</a>
        
          <a class="main-nav-link" href="/categories/摄影">摄影</a>
        
          <a class="main-nav-link" href="/tags">标签</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
          <a class="main-nav-link" href="/about">关于我</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="q" value="site:http://www.haiyue.me"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-nginx-install" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Nginx 安装
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/09/06/nginx-install/" class="article-date">
  <time datetime="2016-09-05T16:00:00.000Z" itemprop="datePublished">2016-09-06</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/笔记/">笔记</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="安装编译工具及库文件">安装编译工具及库文件</h2><ul>
<li>切换到root用户下面</li>
<li>yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel</li>
</ul>
<a id="more"></a>   
<h2 id="安装_PCRE">安装 PCRE</h2><ul>
<li>PCRE 作用是让 Ngnix 支持 Rewrite 功能。</li>
<li>wget <a href="http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz" target="_blank" rel="external">http://downloads.sourceforge.net/project/pcre/pcre/8.35/pcre-8.35.tar.gz</a></li>
<li>tar zxvf pcre-8.35.tar.gz</li>
<li>cd pcre-8.35</li>
<li>./configure</li>
<li>make &amp;&amp; make install</li>
<li>pcre-config —version</li>
</ul>
<h2 id="安装_Nginx">安装 Nginx</h2><ul>
<li>wget <a href="http://nginx.org/download/nginx-1.6.2.tar.gz" target="_blank" rel="external">http://nginx.org/download/nginx-1.6.2.tar.gz</a></li>
<li>tar zxvf nginx-1.6.2.tar.gz</li>
<li>cd nginx-1.6.2</li>
<li>./configure —with-http_stub_status_module —with-http_ssl_module —with-pcre</li>
<li>make &amp;&amp; make install</li>
<li>/usr/local/nginx/sbin/nginx -v</li>
</ul>
<h2 id="Nginx_配置">Nginx 配置</h2><ul>
<li>配置nginx.conf</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">将/usr/<span class="built_in">local</span>/nginx/conf/nginx.conf替换为以下内容</span><br><span class="line"></span><br><span class="line">user  liuhaiming liuhaiming;</span><br><span class="line">worker_processes  <span class="number">4</span>; <span class="comment"># 设置值和CPU核心数一致</span></span><br><span class="line">error_<span class="built_in">log</span> /usr/<span class="built_in">local</span>/nginx/logs/nginx_error.log notice; <span class="comment">#日志位置和日志级别</span></span><br><span class="line">pid        /usr/<span class="built_in">local</span>/nginx/logs/nginx.pid;</span><br><span class="line"><span class="comment">#Specifies the value for maximum file descriptors that can be opened by this process.</span></span><br><span class="line">worker_rlimit_nofile <span class="number">65535</span>;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">        use epoll;</span><br><span class="line">        worker_connections <span class="number">65535</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">        include       mime.types;</span><br><span class="line">        default_<span class="built_in">type</span>  application/octet-stream;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">log</span>_format  main  <span class="string">'$remote_addr - $remote_user [$time_local] "$request" '</span></span><br><span class="line">                      <span class="string">'$status $body_bytes_sent "$http_referer" '</span></span><br><span class="line">                      <span class="string">'"$http_user_agent" "$http_x_forwarded_for"'</span>;</span><br><span class="line"></span><br><span class="line">        server_names_<span class="built_in">hash</span>_bucket_size <span class="number">128</span>;</span><br><span class="line">        client_header_buffer_size <span class="number">32</span>k;</span><br><span class="line">        large_client_header_buffers <span class="number">4</span> <span class="number">32</span>k;</span><br><span class="line">        client_max_body_size <span class="number">8</span>m;</span><br><span class="line"></span><br><span class="line">        sendfile        on;</span><br><span class="line">        tcp_nopush on;</span><br><span class="line">        keepalive_timeout <span class="number">60</span>;</span><br><span class="line">        tcp_nodelay on;</span><br><span class="line">        fastcgi_connect_timeout <span class="number">300</span>;</span><br><span class="line">        fastcgi_send_timeout <span class="number">300</span>;</span><br><span class="line">        fastcgi_<span class="built_in">read</span>_timeout <span class="number">300</span>;</span><br><span class="line">        fastcgi_buffer_size <span class="number">64</span>k;</span><br><span class="line">        fastcgi_buffers <span class="number">4</span> <span class="number">64</span>k;</span><br><span class="line">        fastcgi_busy_buffers_size <span class="number">128</span>k;</span><br><span class="line">        fastcgi_temp_file_write_size <span class="number">128</span>k;</span><br><span class="line">        gzip on;</span><br><span class="line">        gzip_min_length <span class="number">1</span>k;</span><br><span class="line">        gzip_buffers <span class="number">4</span> <span class="number">16</span>k;</span><br><span class="line">        gzip_http_version <span class="number">1.0</span>;</span><br><span class="line">        gzip_comp_level <span class="number">2</span>;</span><br><span class="line">        gzip_types text/plain application/x-javascript text/css application/xml;</span><br><span class="line">        gzip_vary on;</span><br><span class="line"></span><br><span class="line">        <span class="comment">#下面是server虚拟主机的配置</span></span><br><span class="line">        server &#123;</span><br><span class="line">                listen       <span class="number">80</span>; <span class="comment"># 监听端口</span></span><br><span class="line">                server_name  localhost; <span class="comment"># 域名</span></span><br><span class="line"></span><br><span class="line">                charset utf-<span class="number">8</span>;</span><br><span class="line">                access_<span class="built_in">log</span>  logs/host.access.log  main;</span><br><span class="line"></span><br><span class="line">                error_page   <span class="number">500</span> <span class="number">502</span> <span class="number">503</span> <span class="number">504</span>  /<span class="number">50</span>x.html;</span><br><span class="line">                location = /<span class="number">50</span>x.html &#123;</span><br><span class="line">                        root   html;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>检查配置文件ngnix.conf的正确性: /usr/local/nginx/sbin/nginx -t</li>
<li>启动 Nginx: /usr/local/nginx/sbin/nginx</li>
<li>访问站点: <a href="http://182.92.109.136/" target="_blank" rel="external">http://182.92.109.136/</a></li>
</ul>
<h2 id="Nginx_其他命令">Nginx 其他命令</h2><ul>
<li>/usr/local/nginx/sbin/nginx -s reload            # 重新载入配置文件</li>
<li>/usr/local/nginx/sbin/nginx -s reopen            # 重启 Nginx</li>
<li>/usr/local/nginx/sbin/nginx -s stop              # 停止 Nginx</li>
</ul>
<h2 id="常用指令说明">常用指令说明</h2><h3 id="main全局配置">main全局配置</h3><ul>
<li>nginx在运行时与具体业务功能（比如http服务或者email服务代理）无关的一些参数，比如工作进程数，运行的身份等。  </li>
<li>woker_processes 4 在配置文件的顶级main部分，worker角色的工作进程的个数，master进程是接收并分配请求给worker处理。这个数值简单一点可以设置为cpu的核数(grep ^processor /proc/cpuinfo | wc -l)，也是 auto 值，如果开启了ssl和gzip更应该设置成与逻辑CPU数量一样甚至为2倍，可以减少I/O操作。如果nginx服务器还有其它服务，可以考虑适当减少。</li>
<li>worker_cpu_affinity 也是写在main部分。在高并发情况下，通过设置cpu粘性来降低由于多CPU核切换造成的寄存器等现场重建带来的性能损耗。如worker_cpu_affinity 0001 0010 0100 1000; （四核）。</li>
<li>worker_connections 2048 写在events部分。每一个worker进程能并发处理（发起）的最大连接数（包含与客户端或后端被代理服务器间等所有连接数）。nginx作为反向代理服务器，计算公式 最大连接数 = worker_processes * worker_connections/4，所以这里客户端最大连接数是1024，这个可以增到到8192都没关系，看情况而定，但不能超过后面的worker_rlimit_nofile。当nginx作为http服务器时，计算公式里面是除以2。</li>
<li>worker_rlimit_nofile 10240 写在main部分。默认是没有设置，可以限制为操作系统最大的限制65535。</li>
<li>use epoll 写在events部分。在Linux操作系统下，nginx默认使用epoll事件模型，得益于此，nginx在Linux操作系统下效率相当高。同时Nginx在OpenBSD或FreeBSD操作系统上采用类似于epoll的高效事件模型kqueue。在操作系统不支持这些高效模型时才使用select。</li>
</ul>
<h3 id="http服务器">http服务器</h3><ul>
<li>与提供http服务相关的一些配置参数。例如：是否使用keepalive啊，是否使用gzip进行压缩等。</li>
<li>sendfile on 开启高效文件传输模式，sendfile指令指定nginx是否调用sendfile函数来输出文件，减少用户空间到内核空间的上下文切换。对于普通应用设为 on，如果用来进行下载等应用磁盘IO重负载应用，可设置为off，以平衡磁盘与网络I/O处理速度，降低系统的负载。</li>
<li>keepalive_timeout 65 长连接超时时间，单位是秒，这个参数很敏感，涉及浏览器的种类、后端服务器的超时设置、操作系统的设置，可以另外起一片文章了。长连接请求大量小文件的时候，可以减少重建连接的开销，但假如有大文件上传，65s内没上传完成会导致失败。如果设置时间过长，用户又多，长时间保持连接会占用大量资源。</li>
<li>send_timeout 用于指定响应客户端的超时时间。这个超时仅限于两个连接活动之间的时间，如果超过这个时间，客户端没有任何活动，Nginx将会关闭连接。</li>
<li>client_max_body_size 10m 允许客户端请求的最大单文件字节数。如果有上传较大文件，请设置它的限制值</li>
<li>client_body_buffer_size 128k 缓冲区代理缓冲用户端请求的最大字节数</li>
</ul>
<h3 id="模块http_proxy">模块http_proxy</h3><ul>
<li>这个模块实现的是nginx作为反向代理服务器的功能，包括缓存功能</li>
<li>proxy_connect_timeout 60 nginx跟后端服务器连接超时时间(代理连接超时)</li>
<li>proxy_read_timeout 60 连接成功后，与后端服务器两个成功的响应操作之间超时时间(代理接收超时)</li>
<li>proxy_buffer_size 4k 设置代理服务器（nginx）从后端realserver读取并保存用户头信息的缓冲区大小，默认与proxy_buffers大小相同，其实可以将这个指令值设的小一点</li>
<li>proxy_buffers 4 32k proxy_buffers缓冲区，nginx针对单个连接缓存来自后端realserver的响应，网页平均在32k以下的话，这样设置</li>
<li>proxy_busy_buffers_size 64k 高负荷下缓冲大小（proxy_buffers*2）</li>
<li>proxy_max_temp_file_size 当proxy_buffers放不下后端服务器的响应内容时，会将一部分保存到硬盘的临时文件中，这个值用来设置最大临时文件大小，默认1024M，它与proxy_cache没有关系。大于这个值，将从upstream服务器传回。设置为0禁用。</li>
<li>proxy_temp_file_write_size 64k 当缓存被代理的服务器响应到临时文件时，这个选项限制每次写临时文件的大小。proxy_temp_path（可以在编译的时候）指定写到哪那个目录。</li>
<li>proxy_pass，proxy_redirect见 location 部分。</li>
</ul>
<h3 id="模块http_gzip">模块http_gzip</h3><ul>
<li>gzip on : 开启gzip压缩输出，减少网络传输。</li>
<li>gzip_min_length 1k ： 设置允许压缩的页面最小字节数，页面字节数从header头得content-length中进行获取。默认值是20。建议设置成大于1k的字节数，小于1k可能会越压越大。</li>
<li>gzip_buffers 4 16k ： 设置系统获取几个单位的缓存用于存储gzip的压缩结果数据流。4 16k代表以16k为单位，安装原始数据大小以16k为单位的4倍申请内存。</li>
<li>gzip_http_version 1.0 ： 用于识别 http 协议的版本，早期的浏览器不支持 Gzip 压缩，用户就会看到乱码，所以为了支持前期版本加上了这个选项，如果你用了 Nginx 的反向代理并期望也启用 Gzip 压缩的话，由于末端通信是 http/1.0，故请设置为 1.0。</li>
<li>gzip_comp_level 6 ： gzip压缩比，1压缩比最小处理速度最快，9压缩比最大但处理速度最慢(传输快但比较消耗cpu)</li>
<li>gzip_types ：匹配mime类型进行压缩，无论是否指定,”text/html”类型总是会被压缩的。</li>
<li>gzip_proxied any ： Nginx作为反向代理的时候启用，决定开启或者关闭后端服务器返回的结果是否压缩，匹配的前提是后端服务器必须要返回包含”Via”的 header头。</li>
<li>gzip_vary on ： 和http头有关系，会在响应头加个 Vary: Accept-Encoding ，可以让前端的缓存服务器缓存经过gzip压缩的页面，例如，用Squid缓存经过Nginx压缩的数据。。</li>
</ul>
<h3 id="server虚拟主机">server虚拟主机</h3><ul>
<li>http服务上支持若干虚拟主机。每个虚拟主机一个对应的server配置项，配置项里面包含该虚拟主机相关的配置。在提供mail服务的代理时，也可以建立若干server。每个server通过监听地址或端口来区分。</li>
<li>listen 监听端口，默认80，小于1024的要以root启动。可以为listen *:80、listen 127.0.0.1:80等形式。</li>
<li>server_name 服务器名，如localhost、www.example.com，可以通过正则匹配。</li>
</ul>
<h3 id="模块http_stream">模块http_stream</h3><ul>
<li>这个模块通过一个简单的调度算法来实现客户端IP到后端服务器的负载均衡，upstream后接负载均衡器的名字，后端realserver以 host:port options; 方式组织在 {} 中。如果后端被代理的只有一台，也可以直接写在 proxy_pass 。</li>
</ul>
<h3 id="location">location</h3><ul>
<li>http服务中，某些特定的URL对应的一系列配置项。</li>
<li>root /var/www/html 定义服务器的默认网站根目录位置。如果locationURL匹配的是子目录或文件，root没什么作用，一般放在server指令里面或/下。</li>
<li>index index.jsp index.html index.htm 定义路径下默认访问的文件名，一般跟着root放</li>
<li>proxy_pass http:/backend 请求转向backend定义的服务器列表，即反向代理，对应upstream负载均衡器。也可以proxy_pass <a href="http://ip:port。" target="_blank" rel="external">http://ip:port。</a></li>
</ul>
<p>原文链接</p>
<ul>
<li><a href="http://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="external">http://www.runoob.com/linux/nginx-install-setup.html</a></li>
<li><a href="https://segmentfault.com/a/1190000002797601#articleHeader7" target="_blank" rel="external">https://segmentfault.com/a/1190000002797601#articleHeader7</a></li>
</ul>
<p><br></p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Nginx/">Nginx</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/07/05/escape/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">Node.js中用escape解决sql注入&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>


  <section id="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-nginx-install" data-title="Nginx 安装" data-url="http://www.haiyue.me/2016/09/06/nginx-install/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'liuhaiming'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
  </section>
  </section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 寻梦的尕柳&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, theme by <a href="http://github.com/ppoffice">PPOffice</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>